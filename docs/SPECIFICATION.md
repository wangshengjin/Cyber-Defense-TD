# 霓虹塔防 (Cyber Defense TD) 产品与交互规格文档

## 1. 产品概述
**《霓虹塔防》** 是一款基于 PixiJS 高性能渲染引擎和 React 响应式 UI 框架开发的赛博朋克风格塔防游戏。玩家通过在地图上布阵不同类型的防御塔，抵御一波又一波具有不同特性的敌人袭击，保护核心基地。

## 2. 游戏核心数值与机制

### 2.1 资源与状态系统
*   **初始资金**: $450
*   **初始生命**: 20
*   **金钱获取**: 击杀敌人获得（根据敌人类型从 $10 到 $100 不等）。
*   **失败条件**: 生命值降至 0，触发 Game Over 界面。
*   **游戏速度**: 支持 1x 和 2x 速度切换。

### 2.2 防御塔规格 (Towers)
| 类型 | 名称 | 成本 | 范围 (格) | 基础伤害 | 冷却 (ms) | 特性描述 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **LASER** | 激光塔 | $100 | 3.5 | 25 | 600 | 单体高频攻击，发射青色细光束。 |
| **CANNON** | 重炮塔 | $250 | 3.0 | 60 | 1500 | 溅射伤害 (半径 1.5)，发射橙色实体弹丸。 |
| **SLOW** | 冰霜塔 | $150 | 2.5 | 0 | 200 | 无伤害，范围内敌人减速 (初始 0.6x，随等级增强)。 |
| **SNIPER** | 狙击塔 | $400 | 8.0 | 200 | 3000 | 超远距离高伤，发射紫色粗光束。 |

*   **升级机制**: 升级成本为初始成本的 1.5 倍。每升一级提升 50% 基础伤害，冰霜塔额外提升减速强度。
*   **回收机制**: 玩家可随时出售防御塔，返还该塔总投资（建造+升级）的 70%。

### 2.3 敌人规格 (Enemies)
| 类型 | 特性描述 | 基础生命 | 移动速度 | 击杀奖励 | 基地伤害 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **BASIC** | 红色，均衡型。 | 50 | 2.5 | $10 | 1 |
| **FAST** | 黄色，速度快，血量低。 | 30 | 4.5 | $15 | 1 |
| **TANK** | 绿色，血厚，速度慢。 | 200 | 1.5 | $25 | 2 |
| **BOSS** | 紫色，体型巨大，极高血量。 | 1000 | 1.0 | $100 | 10 |

---

## 3. 视觉表现与特效 (Visual FX)

### 3.1 渲染层级 (Z-Index)
1.  **网格层 (Grid)**: 绘制暗色背景与参考线。
2.  **路径层 (Path)**: 带有霓虹发光点的敌人行进路线。
3.  **防御塔层 (Towers)**: 渲染建筑本体与等级标签。
4.  **敌人层 (Enemies)**: 渲染敌人实体及其动态血条（受击或冰冻时有颜色反馈）。
5.  **投射物层 (Projectiles)**: 飞行中的实体炮弹。
6.  **特效层 (FX)**: 瞬时激光束、狙击射线、减速脉冲光环。
7.  **粒子系统 (Particles)**: 所有的命中、爆炸和死亡均伴随大量的加法混合 (Additive Blending) 粒子。

### 3.2 粒子特效细节
*   **击中反馈**: 根据武器类型产生颜色匹配的粒子迸发。
*   **死亡特效**: 敌人死亡时产生大规模、高初速的散落粒子，并带有白色闪光核心。
*   **对象池优化**: 粒子系统预分配 3000 个对象，通过复用 Sprite 保证在高密度战斗下帧率稳定。

---

## 4. 交互流程规格

### 4.1 建造交互 (Build Mode)
1.  **进入模式**: 点击底部面板的塔图标。
2.  **悬停预览**: 
    *   鼠标移动时在网格显示半透明背景框。
    *   **绿色**: 可建造；**红色/默认颜色**: 路径上或已有物体，不可建造。
3.  **范围反馈**: 实时绘制白色半透明圆圈，显示该塔的攻击范围。
4.  **放置确认**: 在合法位置点击，扣除金钱并立即生成实体，随后自动退出建造模式。

### 4.2 管理交互 (Manage Mode)
1.  **选中**: 点击地图上的已建塔。
2.  **UI 切换**: 底部面板切换为“属性管理”视图，显示 Lv、升级成本和出售价格。
3.  **操作锁定**: 选中的塔会持续显示其攻击范围圈。
4.  **升级/出售**: 
    *   金钱不足时升级按钮禁用。
    *   点击出售立即销毁对象并更新金钱，同时清除选中状态。

### 4.3 战斗控制
*   **波次触发**: 手动点击 "Next Wave"。如果当前正在战斗，按钮兼具“暂停”功能。
*   **倍速控制**: 允许在 1x 和 2x 速度间切换，影响所有物理运动和计时器。

---

## 5. 音频系统规格 (Audio Engine)

### 5.1 生成式背景音乐 (BGM)
*   **原理**: 实时 Web Audio 合成，不依赖外部音频文件。
*   **模式**: 110 BPM，4/4 拍，4 小节循环。
*   **音轨结构**:
    *   **Kick (底鼓)**: 稳定的正拍，带有指数频率衰减。
    *   **Hi-Hat (镲片)**: 动态力度的反拍律动。
    *   **Bass (贝斯)**: 随和弦 (Dm-F-Am-G) 进行的锯齿波滚奏。
    *   **Pluck (旋律)**: 随机生成的五声音阶空灵旋律，带有简单的回声效果。

### 5.2 战斗音效 (SFX)
*   **射击**: Laser (高频扫频)、Cannon (低频冲击)、Sniper (瞬时方波爆破)、Slow (带 LFO 的调制音)。
*   **死亡**: 结合了“生物惨叫”（下滑锯齿波）与“躯体破碎”（低通滤波噪音）的有感音效。

---

## 6. 技术架构
*   **核心框架**: React 19 + PixiJS 7。
*   **通信机制**: React 处理 UI 交互逻辑，通过引用单例 `gameEngine` 驱动高性能 Canvas 渲染。
*   **物理引擎**: 自定义线性插值路径算法与简单的欧几里得距离碰撞检测。