# 霓虹塔防 (Cyber Defense TD) 产品与交互规格文档

## 1. 产品概述
**《霓虹塔防》** 是一款基于 **Godot 4** 引擎开发的赛博朋克风格塔防游戏。本项目旨在将原游戏从 React/PixiJS 移植到 Godot，不仅复刻了核心玩法，还针对移动端和原生性能进行了深度优化。

## 2. 游戏核心数值与机制

### 2.1 资源与状态系统
*   **初始资金**: $450
*   **初始生命**: 20
*   **金钱获取**: 击杀敌人获得（根据敌人类型从 $10 到 $100 不等）。
*   **失败条件**: 生命值降至 0，触发 Game Over 界面。
*   **游戏速度**: 支持 1x 和 2x 速度切换。

### 2.2 防御塔规格 (Towers)
| 类型 | 名称 | 成本 | 范围 (px) | 基础伤害 | 冷却 (s) | 特性描述 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **LASER** | 激光塔 | $100 | 175 | 25 | 0.6 | 单体高频攻击，发射青色细光束。 |
| **CANNON** | 重炮塔 | $250 | 150 | 60 | 1.5 | 溅射伤害，发射橙色实体弹丸。 |
| **SLOW** | 冰霜塔 | $150 | 125 | 0 | 0.2 | 无伤害，范围内敌人减速。 |
| **SNIPER** | 狙击塔 | $400 | 400 | 200 | 3.0 | 超远距离高伤，发射紫色粗光束。 |

*   **升级机制**: 升级成本为初始成本的 1.5 倍。每升一级提升 50% 基础伤害。
*   **回收机制**: 玩家可随时出售防御塔，返还该塔总投资的 70%。
*   **注**: Godot版本中范围单位为像素，冷却单位为秒。

### 2.3 敌人规格 (Enemies)
| 类型 | 特性描述 | 基础生命 | 移动速度 (px/s) | 击杀奖励 | 基地伤害 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **BASIC** | 红色，均衡型。 | 50 | 50 | $10 | 1 |
| **FAST** | 黄色，速度快，血量低。 | 30 | 75 | $15 | 1 |
| **TANK** | 绿色，血厚，速度慢。 | 200 | 25 | $25 | 2 |
| **BOSS** | 紫色，体型巨大，极高血量。 | 1000 | 20 | $100 | 10 |

---

## 3. 视觉表现与特效 (Visual FX)

### 3.1 核心表现
*   **渲染引擎**: 基于 **Godot 4 2D 渲染管线**，利用 `GPUParticles2D` 实现高性能粒子效果。
*   **发光效果**: 使用 `WorldEnvironment` 的 `Glow` 效果，实现赛博朋克风格的霓虹光感。
*   **层级管理**: 利用 Godot 的 Node 树结构和 `Z Index` 管理渲染层级 (Map -> Effects -> Enemies -> Towers -> UI)。

### 3.2 粒子特效细节
*   **击中反馈**: 基于 `GPUParticles2D` 的爆发特效，根据武器类型匹配颜色。
*   **死亡特效**: 敌人死亡时产生大规模粒子破碎效果。
*   **优化**: Godot 引擎自动管理粒子生命周期。

---

## 4. 交互与控制

### 4.1 移动端适配
*   **分辨率**: 适配标准移动端横屏分辨率 (1280x720 / 1920x1080)。
*   **输入方式**: 
    *   **触控模拟**: 启用 `Emulate Touch From Mouse` 和 `Emulate Mouse From Touch`，确保在桌面和移动设备上体验一致。
    *   **多点触控**: 支持基础的点击操作。

### 4.2 游戏控制
*   **UI 布局**: 采用 Control 节点 (CanvasLayer) 确保 UI 始终浮于游戏层之上。
*   **建造/升级**: 点击底部 HUD 选择塔，点击地图放置；点击已放置的塔弹出升级/出售菜单。

---

## 5. 音频系统 (Audio)
*   **音效管理**: 使用 Godot 的 `AudioStreamPlayer` 节点。
*   **总线系统**: 单独的 SFX 和 Music 总线，便于音量控制。

---

## 6. 技术架构
*   **引擎**: Godot Engine 4.x
*   **语言**: GDScript
*   **场景结构**:
    *   `Game.tscn`: 主游戏场景，包含地图、EntityLayer、UILayer。
    *   `Map.tscn`: 瓦片地图 (TileMap)。
    *   `Entities`: 敌人、塔、投射物均为独立 PackedScene。
*   **单例模式 (Autoload)**:
    *   `GameManager`: 管理全局游戏状态（金钱、生命、波次、选中状态）。
    *   `Constants`: 存储全局常量配置。