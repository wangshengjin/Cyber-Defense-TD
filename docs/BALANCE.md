# 霓虹塔防 (Cyber Defense TD) 数值平衡设计文档

本文件详细说明了游戏中的伤害计算、血量缩放以及经济系统的平衡逻辑。

## 1. 核心伤害公式 (Damage Formula)

### 1.1 基础伤害计算
防御塔的最终伤害由其基础值和等级系数决定：
$$Damage_{final} = Damage_{base} \times (1 + (Level - 1) \times 0.5)$$
*   **Level 1**: $100\%$ 基础伤害
*   **Level 2**: $150\%$ 基础伤害
*   **Level 3**: $200\%$ 基础伤害

### 1.2 秒伤 (DPS) 效率分析 (Level 1)
| 塔类型 | 基础 DPS | 成本 | 效率 (DPS/$) | 战略价值 |
| :--- | :--- | :--- | :--- | :--- |
| **LASER** | 41.6 | $100 | 0.416 | 极高性价比，适合前期铺场 |
| **CANNON** | 40.0 | $250 | 0.160 | 溅射收益，敌人密度越高效率越高 |
| **SNIPER** | 66.6 | $400 | 0.166 | 极高单发，利用射程覆盖多个路段 |
| **SLOW** | 0.0 | $150 | - | 辅助核心，通过增加 TTK 变相提升其他塔 DPS |

---

## 2. 敌人血量缩放 (Enemy HP Scaling)

### 2.1 波次增长公式
为了确保游戏挑战性随时间线性且略带指数级增长，敌人血量遵循以下缩放：
*   **前7波**: 采用手动配置的 `hpMultiplier` (1.0x - 2.0x)。
*   **无限波次 (Wave > 7)**: 
    $$HP_{scale} = 1 + (WaveIndex \times 0.2)$$
    *即每增加一波，敌人的基础血量上限提升 20%。*

### 2.2 击杀时间 (Time-to-Kill, TTK) 计算模型
假设敌人移动路径在塔射程内的长度为 $L$ (平均约为 $2 \times Range$)。
$$TTK_{required} = \frac{HP_{enemy}}{DPS_{total}}$$
$$Time_{available} = \frac{L}{Speed \times SlowFactor}$$
**平衡准则**: 只有当 $Time_{available} \geq TTK_{required}$ 时，防御塔阵列才能成功拦截敌人。

---

## 3. 减速机制平衡 (Slow Mechanics)

减速塔不直接产生伤害，但其贡献通过**时间放大效应**体现：
$$DPS_{effective} = DPS_{base} \times \frac{1}{SlowFactor}$$
*   **Level 1 (0.6x Speed)**: 相当于范围内其他塔的 DPS 提升了约 **66%**。
*   **Level 2 (0.55x Speed)**: 提升约 **81%**。
*   **Level 3 (0.50x Speed)**: 提升约 **100%**。

*注：减速下限设定为 0.2x，防止敌人完全静止。*

---

## 4. 经济模型 (Economy)

### 4.1 投资回报率 (ROI)
*   **升级成本**: 统一为初始成本的 $1.5$ 倍。
*   **出售收益**: 
    $$Refund = (Cost_{build} + Cost_{upgrade\_total}) \times 0.7$$
    *设定 70% 的回收率是为了鼓励玩家在后期根据敌人类型（如从大量的 FAST 变为单个 BOSS）进行阵型重构，而非死守旧塔。*

### 4.2 边际收益递减
虽然升级能提升 50% 的伤害，但升级成本通常高于新建一座塔（以激光塔为例，新建需 $100，升级需 $150）。
*   **策略选择**: 空间有限时优先升级，空间充裕时优先铺场。

---

## 5. 关卡难度控制点
*   **第 3 波 (FAST 引入)**: 考量玩家对射速或减速塔的布局。
*   **第 4 波 (TANK 引入)**: 考量总 DPS 是否达标，基础激光塔开始显得乏力。
*   **第 7 波 (BOSS)**: 终极考量，BOSS 的 1000 基准血量配合波次加成，要求玩家必须拥有至少 2-3 座高等级狙击塔或重炮阵列。